Skip to content You said: Could you please ponder the following: [Starts here] /ngr ├── access.log ├── ai-commit-handler.php ├── backup/ ├── chunk-committer.html ├── chunk-committer.php ├── chunk-simulator.html ├── chunk-simulator.php ├── config.php ├── env-test.php ├── generate-php.php ├── github-helper.php ├── hash-file.php ├── load_env.php ├── openai-helper.php ├── robots.txt ├── test-uploader.html └── verify_sha256.php --- File Contents in /ngr root --- [Starts here - access.log] [2025-09-24 03:02:08] IP: 49.224.90.1 | File: hello-02.txt | ✅ SUCCESS | SHA: 36a60d4659381c07dcaaa7c11fd1f9473d4e1489 [2025-09-24 03:18:25] IP: 49.224.90.1 | ❌ FAIL | Token mismatch [2025-09-24 03:18:53] IP: 49.224.90.1 | ❌ FAIL | Token mismatch [2025-09-24 03:19:35] IP: 49.224.90.1 | File: hello-03.txt | ✅ SUCCESS | SHA: d738c0eda324722e5e9a436d5ff868f9647cb146 [Ends here - access.log] [Starts here - ai-commit-handler.php] <?php // ai-commit-handler.php require_once 'config.php'; require_once 'github-helper.php'; error_reporting(E_ALL); ini_set('display_errors', 1); header('Content-Type: application/json'); // ====== PART 1: IP WHITELIST PROTECTION ====== $allowed_ips = ['49.224.90.1', '127.0.0.1']; $client_ip = $_SERVER['REMOTE_ADDR'] ?? 'UNKNOWN'; if (!in_array($client_ip, $allowed_ips)) { log_access($client_ip, null, false, 'IP not allowed'); http_response_code(403); echo json_encode(['success' => false, 'error' => 'Forbidden: IP not allowed']); exit; } // ====== PART 2: TOKEN AUTH CHECK (Supports Multiple Tokens) ====== $provided_token = $_SERVER['HTTP_X_AI_TOKEN'] ?? ''; $valid = false; // Load all tokens that start with AI_COMMIT_SECRET* foreach ($_ENV as $key => $value) { if (strpos($key, 'AI_COMMIT_SECRET') === 0 && $value === $provided_token) { $valid = true; break; } } if (!$valid) { log_access($client_ip, null, false, 'Token mismatch'); http_response_code(401); echo json_encode(['success' => false, 'error' => 'Unauthorized - invalid token']); exit; } // ====== PART 3: INPUT PARSING ====== $input = json_decode(file_get_contents('php://input'), true); $filename = $input['filename'] ?? null; $content = $input['content'] ?? null; $commit_message = $input['commit_message'] ?? 'AI Update'; if (!$filename || !$content) { log_access($client_ip, $filename, false, 'Missing filename or content'); http_response_code(400); echo json_encode(['success' => false, 'error' => 'Missing filename or content']); exit; } // ====== PART 4: COMMIT TO GITHUB ====== $repo_owner = 'blackbox-world'; $repo_name = 'nexus'; $branch = 'main'; $result = github_update_file($repo_owner, $repo_name, $filename, $content, $commit_message, $branch); if ($result['success']) { $sha = $result['data']['content']['sha'] ?? 'N/A'; log_access($client_ip, $filename, true, "SHA: $sha"); echo json_encode([ 'success' => true, 'file' => $filename, 'commit_url' => $result['data']['commit']['html_url'] ?? null, 'sha' => $sha ]); } else { log_access($client_ip, $filename, false, $result['error']); http_response_code(500); echo json_encode(['success' => false, 'error' => $result['error']]); } // ====== PART 5: LOGGING FUNCTION ====== function log_access($ip, $file, $success, $extra = '') { $status = $success ? '✅ SUCCESS' : '❌ FAIL'; $timestamp = date('[Y-m-d H:i:s]'); $line = "$timestamp IP: $ip"; if ($file) { $line .= " | File: $file"; } $line .= " | $status"; if ($extra) { $line .= " | $extra"; } file_put_contents(__DIR__ . '/access.log', $line . PHP_EOL, FILE_APPEND); } [Ends here - ai-commit-handler.php] [Starts here - chunk-committer.html] <!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8" /> <title>Chunk Committer</title> <style> body { font-family: sans-serif; max-width: 800px; margin: 2em auto; } textarea, input, select { width: 100%; margin-top: 1em; padding: 0.5em; } button { margin-top: 1em; padding: 0.75em 1.5em; } pre { background: #f9f9f9; padding: 1em; border-radius: 5px; white-space: pre-wrap; } </style> </head> <body> <h1>Chunk Committer 🧠📤</h1> <form id="chunkForm"> <label>Paste Google Doc Text:</label> <textarea id="fullText" rows="15" required></textarea> <label>Chunk size (words per chunk):</label> <input type="number" id="chunkSize" value="2000" min="100" /> <label>Maximum chunks to commit:</label> <input type="number" id="maxChunks" value="5" min="1" /> <label>Commit message prefix:</label> <input type="text" id="commitPrefix" value="Google Doc Chunk" /> <label>Filename base (e.g. doc-part):</label> <input type="text" id="filenameBase" value="doc-part" /> <label>Secret Token (X-AI-Token):</label> <input type="text" id="token" placeholder="Required" required /> <button type="submit">Split & Commit</button> </form> <div id="results"></div> <script> document.getElementById('chunkForm').addEventListener('submit', async function(e) { e.preventDefault(); const text = document.getElementById('fullText').value; const chunkSize = parseInt(document.getElementById('chunkSize').value); const maxChunks = parseInt(document.getElementById('maxChunks').value); const commitPrefix = document.getElementById('commitPrefix').value.trim(); const filenameBase = document.getElementById('filenameBase').value.trim(); const token = document.getElementById('token').value.trim(); const res = await fetch('chunk-committer.php', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ text, chunkSize, maxChunks, commitPrefix, filenameBase, token }) }); const html = await res.text(); document.getElementById('results').innerHTML = html; }); </script> </body> </html> [Ends here - chunk-committer.html] [Starts here - chunk-committer.php] <?php // chunk-committer.php require_once 'config.php'; header('Content-Type: text/html'); // ====== Get POSTed JSON ====== $data = json_decode(file_get_contents('php://input'), true); $text = $data['text'] ?? ''; $chunkSize = intval($data['chunkSize'] ?? 2000); $maxChunks = intval($data['maxChunks'] ?? 5); $commitPrefix = trim($data['commitPrefix'] ?? 'Chunk Upload'); $filenameBase = trim($data['filenameBase'] ?? 'doc-part'); $token = trim($data['token'] ?? ''); if (!$text || !$token) { echo "<p style='color: red;'>❌ Missing text or token.</p>"; exit; } // ====== Chunk the text ====== $words = preg_split('/\s+/', $text); $chunks = array_chunk($words, $chunkSize); $totalChunks = min(count($chunks), $maxChunks); echo "<h2>🚀 Starting Commit of $totalChunks Chunks</h2><ul>"; for ($i = 0; $i < $totalChunks; $i++) { $chunkText = implode(' ', $chunks[$i]); $filename = sprintf('%s-%02d.md', $filenameBase, $i + 1); $commitMessage = sprintf('%s #%d', $commitPrefix, $i + 1); $payload = json_encode([ 'filename' => $filename, 'content' => $chunkText, 'commit_message' => $commitMessage ]); // ====== cURL POST to ai-commit-handler.php ====== $ch = curl_init('ai-commit-handler.php'); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_POSTFIELDS, $payload); curl_setopt($ch, CURLOPT_HTTPHEADER, [ 'Content-Type: application/json', 'X-AI-Token: ' . $token ]); $response = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); curl_close($ch); $result = json_decode($response, true); if ($result['success'] ?? false) { echo "<li>✅ <strong>$filename</strong> committed<br>📎 <a href='{$result['commit_url']}' target='_blank'>View Commit</a></li>"; } else { $error = htmlspecialchars($result['error'] ?? 'Unknown error'); echo "<li>❌ <strong>$filename</strong> failed: $error</li>"; } flush(); // Send output incrementally } echo "</ul><p>🧠 Done. Check GitHub repo for updates.</p>"; [Ends here - chunk-committer.php] [Starts here - chunk-simulator.html] <!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8" /> <title>Chunk Uploader & Formatter</title> <style> body { font-family: sans-serif; max-width: 800px; margin: 2em auto; } textarea, input { width: 100%; margin-top: 1em; padding: 0.5em; } button { margin-top: 1em; padding: 0.75em 1.5em; } pre { background: #f4f4f4; padding: 1em; border-radius: 5px; white-space: pre-wrap; } </style> </head> <body> <h1>Chunk Uploader & Formatter</h1> <form id="chunkForm"> <label>Paste your full text (e.g. Google Doc export):</label> <textarea id="fullText" rows="15"></textarea> <label>Chunk size (words per chunk):</label> <input type="number" id="chunkSize" value="300" /> <button type="submit">Chunk & Simulate</button> </form> <div id="results"></div> <script> document.getElementById('chunkForm').addEventListener('submit', async function(e) { e.preventDefault(); const fullText = document.getElementById('fullText').value; const chunkSize = parseInt(document.getElementById('chunkSize').value); const res = await fetch('chunk-simulator.php', { method: 'POST', headers: { 'Content-Type': 'application/json' }, body: JSON.stringify({ fullText, chunkSize }) }); const data = await res.text(); document.getElementById('results').innerHTML = data; }); </script> </body> </html> [Ends here - chunk-simulator.html] [Starts here - chunk-simulator.php] <?php // chunk-simulator.php header('Content-Type: text/html'); $input = json_decode(file_get_contents('php://input'), true); $text = $input['fullText'] ?? ''; $chunkSize = intval($input['chunkSize'] ?? 300); // Split text into words $words = preg_split('/\s+/', $text); $chunks = array_chunk($words, $chunkSize); echo "<h2>🧠 Simulated AI Responses per Chunk</h2>"; foreach ($chunks as $index => $chunkWords) { $chunkText = implode(' ', $chunkWords); $summary = substr($chunkText, 0, 150) . (strlen($chunkText) > 150 ? '...' : ''); $hash = hash('sha256', $chunkText); $timestamp = date('Y-m-d H:i:s'); echo "<pre><strong>Chunk #" . ($index + 1) . "</strong>\n"; echo "Words: " . count($chunkWords) . "\n"; echo "Timestamp: $timestamp\n"; echo "SHA256: $hash\n"; echo "\nMock Summary:\n"; echo $summary . "\n</pre>"; } [Ends here - chunk-simulator.php] [Starts here - config.php] <?php // config.php require_once __DIR__ . '/load_env.php'; define('GITHUB_TOKEN', getenv('GITHUB_TOKEN')); define('GITHUB_REPO', 'nexus'); define('GITHUB_OWNER', 'blackbox-world'); define('AI_COMMIT_SECRET', getenv('AI_COMMIT_SECRET')); [Ends here - config.php] [Starts here - env-test.php] <?php require_once 'load_env.php'; echo "<pre>"; echo "GITHUB_TOKEN: " . getenv('GITHUB_TOKEN') . "\n"; echo "AI_COMMIT_SECRET: " . getenv('AI_COMMIT_SECRET') . "\n"; echo "</pre>"; [Ends here - env-test.php] [Starts here - generate-php.php] <?php // generate-php.php require_once 'openai-helper.php'; $prompt = "Write a simple PHP function that calculates the factorial of a number using recursion."; $response = openai_generate_code($prompt); header('Content-Type: text/plain'); echo "=== Prompt ===\n$prompt\n\n=== Response ===\n$response\n"; [Ends here - generate-php.php] [Starts here - github-helper.php] <?php // github-helper.php require_once 'config.php'; // Load GITHUB_TOKEN $token = GITHUB_TOKEN; // Now works perfectly function github_get_file_info($owner, $repo, $path, $branch = 'main') { $token = getenv('GITHUB_TOKEN'); $url = "https://api.github.com/repos/$owner/$repo/contents/$path?ref=$branch"; $ch = curl_init($url); curl_setopt($ch, CURLOPT_HTTPHEADER, [ "User-Agent: blackbox-world-agent", "Authorization: token $token" ]); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); $response = curl_exec($ch); $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE); curl_close($ch); if ($http_code === 200) { $data = json_decode($response, true); return [ 'sha' => $data['sha'] ?? null, 'content' => base64_decode($data['content'] ?? ''), ]; } elseif ($http_code === 404) { // File does not exist yet return null; } else { return null; } } function github_update_file($owner, $repo, $path, $content, $commit_message, $branch = 'main') { $token = getenv('GITHUB_TOKEN'); $api_url = "https://api.github.com/repos/$owner/$repo/contents/$path"; $file_info = github_get_file_info($owner, $repo, $path, $branch); $sha = $file_info['sha'] ?? null; $payload = [ 'message' => $commit_message, 'content' => base64_encode($content), 'branch' => $branch, ]; if ($sha) { $payload['sha'] = $sha; } $ch = curl_init($api_url); curl_setopt($ch, CURLOPT_HTTPHEADER, [ "User-Agent: blackbox-world-agent", "Authorization: token $token", "Content-Type: application/json" ]); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_CUSTOMREQUEST, 'PUT'); curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($payload)); $response = curl_exec($ch); $http_code = curl_getinfo($ch, CURLINFO_HTTP_CODE); curl_close($ch); if (in_array($http_code, [200, 201])) { return ['success' => true, 'data' => json_decode($response, true)]; } return ['success' => false, 'error' => "GitHub API error (HTTP $http_code): $response"]; } [Ends here - github-helper.php] [Starts here - hash-file.php] <?php // hash-file.php // Computes SHA‑256 of a .md or code file, optionally up to <!-- HASH-END --> $target = $_GET['file'] ?? ''; if (!$target || !file_exists($target)) { echo "File not found or not specified."; exit; } $content = file_get_contents($target); $cutoff = '<!-- HASH‑END -->'; if (strpos($content, $cutoff) !== false) { $content = substr($content, 0, strpos($content, $cutoff) + strlen($cutoff)); } $hash = hash('sha256', $content); $shaFile = $target . '.sha256.txt'; file_put_contents($shaFile, $hash . ' ' . $target); echo "<pre>SHA‑256 for $target:\n$hash\nSaved to $shaFile</pre>"; [Ends here - hash-file.php] [Starts here - load_env.php] <?php // load_env.php - Simple .env loader for PHP (no external packages) // Get full path to .env file $envPath = __DIR__ . '/.env'; if (file_exists($envPath)) { $lines = file($envPath, FILE_IGNORE_NEW_LINES | FILE_SKIP_EMPTY_LINES); foreach ($lines as $line) { // Skip comments if (strpos(trim($line), '#') === 0) continue; // Split into key=value list($key, $value) = explode('=', $line, 2); // Remove quotes and whitespace $key = trim($key); $value = trim($value, " \t\n\r\0\x0B\"'"); // Set environment variable putenv("$key=$value"); $_ENV[$key] = $value; $_SERVER[$key] = $value; } } [Ends here - load_env.php] [Starts here - openai-helper.php] <?php // openai-helper.php require_once 'config.php'; function openai_generate_code($prompt, $temperature = 0.7, $max_tokens = 500) { $apiKey = getenv('OPENAI_API_KEY'); $url = 'https://api.openai.com/v1/chat/completions'; $data = [ 'model' => 'gpt-4', 'messages' => [ ['role' => 'system', 'content' => 'You are a helpful AI that writes clean PHP or Markdown files.'], ['role' => 'user', 'content' => $prompt] ], 'temperature' => $temperature, 'max_tokens' => $max_tokens ]; $headers = [ 'Content-Type: application/json', 'Authorization: Bearer ' . $apiKey ]; $ch = curl_init($url); curl_setopt($ch, CURLOPT_RETURNTRANSFER, true); curl_setopt($ch, CURLOPT_POSTFIELDS, json_encode($data)); curl_setopt($ch, CURLOPT_HTTPHEADER, $headers); $response = curl_exec($ch); $httpCode = curl_getinfo($ch, CURLINFO_HTTP_CODE); curl_close($ch); if ($httpCode === 200) { $result = json_decode($response, true); return $result['choices'][0]['message']['content'] ?? ''; } else { return "Error from OpenAI (HTTP $httpCode): $response"; } } [Ends here - openai-helper.php] [Starts here - robots.txt] User-agent: * Disallow: / [Ends here - robots.txt] [Starts here - test-uploader.html] <!DOCTYPE html> <html lang="en"> <head> <meta charset="UTF-8" /> <meta name="viewport" content="width=device-width, initial-scale=1" /> <title>AI Commit Test Uploader</title> <style> body { font-family: Arial, sans-serif; max-width: 700px; margin: 2em auto; } label { display: block; margin-top: 1em; } textarea { width: 100%; height: 300px; font-family: monospace; font-size: 14px; } input[type=text], textarea { padding: 0.5em; border: 1px solid #ccc; border-radius: 4px; } button { margin-top: 1em; padding: 0.75em 1.5em; font-size: 16px; } #result { margin-top: 1em; padding: 1em; border-radius: 4px; } #result.success { background: #d4edda; color: #155724; } #result.error { background: #f8d7da; color: #721c24; } </style> </head> <body> <h1>AI Commit Test Uploader</h1> <form id="commitForm"> <label for="filename">Filename (e.g. build.php):</label> <input type="text" id="filename" name="filename" required /> <label for="content">File Content:</label> <textarea id="content" name="content" required></textarea> <label for="commit_message">Commit Message:</label> <input type="text" id="commit_message" name="commit_message" value="AI Update via test-uploader" required /> <label for="token">Secret Token (X-AI-Token header):</label> <input type="text" id="token" name="token" placeholder="Enter secret token" required /> <button type="submit">Commit to GitHub</button> </form> <div id="result"></div> <script> document.getElementById('commitForm').addEventListener('submit', async function(e) { e.preventDefault(); const filename = document.getElementById('filename').value.trim(); const content = document.getElementById('content').value; const commit_message = document.getElementById('commit_message').value.trim(); const token = document.getElementById('token').value.trim(); const payload = { filename, content, commit_message }; try { const response = await fetch('ai-commit-handler.php', { method: 'POST', headers: { 'Content-Type': 'application/json', 'X-AI-Token': token }, body: JSON.stringify(payload) }); const data = await response.json(); const resultDiv = document.getElementById('result'); if (data.success) { resultDiv.className = 'success'; resultDiv.innerHTML = ✅ File <strong>${data.file}</strong> committed successfully!<br> Commit URL: <a href="${data.commit_url}" target="_blank">${data.commit_url}</a><br> SHA: ${data.sha} ; } else { resultDiv.className = 'error'; resultDiv.textContent = ❌ Commit failed: ${data.error || 'Unknown error'}; } } catch (err) { const resultDiv = document.getElementById('result'); resultDiv.className = 'error'; resultDiv.textContent = '❌ Request error: ' + err.message; } }); </script> </body> </html> [Ends here - test-uploader.html] [Starts here - verify_sha256.php] <?php /** * verify_sha256.php *